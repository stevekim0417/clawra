# CP-001: WhatsApp 한국 남친 봇 서비스 검토서

**문서번호:** CP-001
**작성일:** 2026-02-17
**상태:** 검토 중
**프로젝트:** Clawra - WhatsApp Korean Boyfriend Bot

---

## 1. 서비스 개요

### 1.1 컨셉

영화 "Her"에서 영감을 받은 AI 남자친구 서비스.
구독자에게 WhatsApp을 통해 한국 남자친구 컨셉의 1:1 대화, 셀카, 영상을 제공한다.

### 1.2 핵심 가치

- 감성적이고 자연스러운 한국 남친 스타일 대화
- fal.ai 기반 얼굴 일관성 있는 셀카/영상 제공
- 유저가 원할 때 언제든 대화 가능 + 봇이 먼저 연락하는 자연스러운 관계감

### 1.3 서비스 흐름

| 구분 | 빈도 | 설명 |
|------|------|------|
| 봇 선톡 (Proactive) | 주 1~2회 | 아침 인사, 퇴근 안부 등 Template Message로 발송 |
| 유저 먼저 (Reactive) | 무제한 | 유저가 메시지 보내면 24시간 대화창 활성화, AI 자유 대화 |

---

## 2. 현재 코드베이스 분석

### 2.1 이미 보유한 인프라

| 기능 | 구현 상태 | 위치 |
|------|----------|------|
| WhatsApp 메시지 발송 | 구현됨 | OpenClaw Gateway (`localhost:18789`) |
| fal.ai 이미지 생성 | 구현됨 | `scripts/clawra-selfie.ts` |
| 얼굴 일관성 (Reference Image Edit) | 구현됨 | xAI Grok Imagine `/edit` 엔드포인트 |
| 페르소나 시스템 | 구현됨 | `SOUL.md` + `IDENTITY.md` 구조 |
| 멀티 플랫폼 메시징 | 구현됨 | Discord, Telegram, WhatsApp, Slack, Signal, Teams |

### 2.2 기술 스택

- **런타임:** Node.js >= 18.0.0 / TypeScript
- **이미지 AI:** fal.ai (`@fal-ai/client ^1.2.0`)
- **메시징 게이트웨이:** OpenClaw (WhatsApp JID 포맷: `번호@s.whatsapp.net`)
- **데이터베이스:** 없음 (현재 stateless 구조)

### 2.3 추가 개발 필요 사항

| 항목 | 현재 | 목표 | 우선순위 |
|------|------|------|---------|
| 유저 DB | 없음 | 구독자/대화기록/설정 관리 | P0 |
| 한국 남친 페르소나 | Clawra (여성) | 한국 남자 캐릭터 | P0 |
| 대화 엔진 | 없음 | Claude API + 컨텍스트 관리 | P0 |
| 스케줄러 | 없음 | 주 1~2회 선톡 Cron | P1 |
| 동영상 생성 | 없음 | fal.ai 영상 모델 연동 | P1 |
| 결제 시스템 | 없음 | Stripe 등 구독 결제 | P2 |

---

## 3. WhatsApp Business API 정책 검토

### 3.1 메시지 유형별 정책

| 유형 | 조건 | 비용 |
|------|------|------|
| **유저 먼저 (User-Initiated)** | 24시간 내 자유 응답 | 무료 (Service Conversation) |
| **봇 먼저 (Business-Initiated)** | Meta 승인 Template 필요 | 유료 (건당 $0.03~0.08) |

### 3.2 발송 한도 (Tier 시스템)

| Tier | 24시간 내 발송 가능 유저 수 |
|------|---------------------------|
| Tier 1 (신규) | 1,000명 |
| Tier 2 | 10,000명 |
| Tier 3 | 100,000명 |
| Tier 4 | 무제한 |

- 품질 점수 양호 시 자동 Tier 업그레이드
- 차단/신고 비율 높으면 Tier 다운그레이드 또는 번호 정지

### 3.3 정책 리스크

| 리스크 | 대응 방안 |
|--------|----------|
| 성인 콘텐츠 금지 | 셀카/대화 수위 제한, 콘텐츠 필터링 적용 |
| 스팸 판정 | 유저 opt-in 필수, 선톡 빈도 주 1~2회로 제한 |
| 비즈니스 인증 필요 | Meta Business 계정 사전 승인 |
| 번호 정지 위험 | 품질 모니터링, 차단율 추적 |

---

## 4. 시스템 아키텍처

### 4.1 전체 구조

```
┌─────────────────────────────────────────────────┐
│               WhatsApp Business API              │
│           (Meta Cloud API / OpenClaw)             │
└──────────┬──────────────────────┬───────────────┘
           │ Webhook (유저 메시지)  │ REST API (봇 발송)
           ▼                      ▲
┌──────────────────────────────────────────────────┐
│                메인 서버 (Node.js)                 │
│                                                   │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
│  │  대화 엔진    │ │  스케줄러     │ │  미디어 생성  │ │
│  │ (Claude API) │ │  (Cron)     │ │  (fal.ai)   │ │
│  └──────┬──────┘ └──────┬──────┘ └──────┬──────┘ │
│         └───────────┬───┴───────────────┘         │
│                     ▼                             │
│  ┌─────────────────────────────────────────────┐  │
│  │                 Database                     │  │
│  │  users: 구독 상태, 폰번호, 설정              │  │
│  │  conversations: 대화 기록, 컨텍스트           │  │
│  │  media_cache: 생성된 사진/영상 URL            │  │
│  │  schedules: 선톡 스케줄, 발송 이력            │  │
│  └─────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────┘
```

### 4.2 대화 엔진

```
유저 메시지 수신
    │
    ▼
유저 DB 조회 (구독 상태 확인)
    │
    ▼
최근 대화 기록 로드 (컨텍스트)
    │
    ▼
Claude API 호출
  - System: 한국 남친 페르소나
  - Context: 최근 대화 기록
  - User: 유저 메시지
    │
    ▼
응답에 셀카 요청 포함?
  ├─ Yes → fal.ai 이미지 생성 → 미디어 + 텍스트 발송
  └─ No  → 텍스트만 발송
    │
    ▼
대화 기록 저장
```

### 4.3 스케줄러 (선톡 시스템)

```
Cron Job (매일 실행)
    │
    ▼
오늘 선톡 대상 유저 조회
  - 구독 활성 상태
  - 마지막 선톡 후 3~4일 경과
  - 유저 타임존 기준 적절한 시간대
    │
    ▼
상황별 프롬프트 선택 (아침/저녁/주말 등)
    │
    ▼
fal.ai 셀카 생성 (상황에 맞는 프롬프트)
    │
    ▼
WhatsApp Template Message 발송
    │
    ▼
발송 이력 기록
```

---

## 5. fal.ai 미디어 생성 전략

### 5.1 얼굴 일관성 유지

현재 코드베이스의 `xai/grok-imagine-image/edit` 엔드포인트를 활용한다.

```
[기본 남친 이미지] → Reference Image로 고정 등록
         │
         ▼
  edit 모드로 상황별 이미지 생성
  → 동일 얼굴, 다른 배경/의상/표정
```

- **기본 이미지:** 한국 남자 캐릭터 기본 셀카 1장 생성 후 고정
- **상황별 생성:** 모든 후속 이미지는 edit 모드로 얼굴 일관성 유지

### 5.2 상황별 프롬프트 설계

| 상황 | 프롬프트 (예시) |
|------|----------------|
| 아침 셀카 | `Korean handsome boyfriend, morning selfie, messy bed hair, cozy bedroom, natural light` |
| 카페 | `Korean handsome boyfriend, cafe selfie, holding americano, warm lighting, casual outfit` |
| 운동 후 | `Korean handsome boyfriend, gym mirror selfie, workout clothes, post-workout glow` |
| 야경 | `Korean handsome boyfriend, city night view selfie, rooftop, romantic mood lighting` |
| 요리 중 | `Korean handsome boyfriend, kitchen selfie, cooking, wearing apron, smiling` |
| 출근길 | `Korean handsome boyfriend, morning commute selfie, suit, subway/street background` |

### 5.3 동영상 생성

fal.ai 영상 모델을 활용하여 짧은 클립 생성:

| 모델 후보 | 용도 |
|-----------|------|
| `minimax/video-01` | 짧은 인사 영상 (3~5초) |
| `kling-ai/v1.5` | 고품질 영상 |

- 생성된 이미지를 첫 프레임으로 사용하여 얼굴 일관성 유지
- 간단한 동작 (손 흔들기, 미소, 윙크 등)

---

## 6. 대화 예시 시나리오

### 6.1 봇 선톡 (주 1~2회)

```
[월요일 오전 8:00 - Template Message]
━━━━━━━━━━━━━━━━━━━━━━━━━━
🧑 남친봇: 좋은 아침~ 오늘 하루도 화이팅해 ❤️
📸 [출근길 셀카 이미지]
━━━━━━━━━━━━━━━━━━━━━━━━━━

유저: 오빠 오늘도 멋있다 ㅋㅋ
  → 24시간 대화창 열림, AI 자유 대화 시작

🧑 남친봇: ㅋㅋㅋ 아침부터 기분 좋게 해주네~
          오늘 뭐 먹을거야? 점심
유저: 아직 모르겠어
🧑 남친봇: 제육볶음 어때? 월요일엔 매운게 최고지 🔥
```

### 6.2 유저 먼저 (일상 대화)

```
유저: 오빠 심심해
🧑 남친봇: 나도~ 너 생각하고 있었는데 ㅎㅎ
          뭐하고 있었어?
유저: 그냥 넷플릭스 보고 있었어
🧑 남친봇: 뭐 봐? 요즘 재밌는거 있어?
유저: 오빠 셀카 보내줘
🧑 남친봇: 잠깐만~
📸 [fal.ai 실시간 생성 - 소파에서 셀카]
🧑 남친봇: 방금 찍었어 ㅋㅋ 나도 넷플릭스 보는 중
```

### 6.3 감성 대화

```
유저: 오늘 회사에서 힘들었어...
🧑 남친봇: 에이 무슨 일 있었어? 😢
          얘기해봐 다 들어줄게
유저: 상사한테 혼났어
🧑 남친봇: 진짜? 너 열심히 하는데...
          네 잘못 아니야. 힘들었겠다
          오늘 집에서 푹 쉬어. 맛있는거 시켜먹어!
유저: 고마워 오빠 ㅠㅠ
🧑 남친봇: 당연하지~ 내가 옆에 있으면 안아줄텐데 🤗
```

---

## 7. 비용 추정

### 7.1 유저 1,000명 기준 월간 비용

| 항목 | 산출 근거 | 월 예상 비용 |
|------|----------|-------------|
| WhatsApp Template (봇 선톡) | 8회/월 × 1,000명 × $0.05 | $400 |
| WhatsApp 유저 대화 (24h 윈도우) | 무료 | $0 |
| Claude API (대화 생성) | 30회/월/유저 × 1,000명 × $0.01 | $300 |
| fal.ai 이미지 생성 | 20장/월/유저 × 1,000명 × $0.01 | $200 |
| fal.ai 영상 생성 | 5건/월/유저 × 1,000명 × $0.10 | $500 |
| 서버 (VPS) | 단일 서버 | $50 |
| **합계** | | **~$1,450/월** |

### 7.2 유저당 원가

- **유저당 월 원가:** ~$1.45
- **권장 구독 가격:** $9.99 ~ $14.99/월
- **예상 마진율:** 85% ~ 90%

### 7.3 스케일별 비용 변화

| 유저 수 | 월 비용 | 유저당 원가 | 월 매출 ($9.99) | 월 이익 |
|---------|---------|-----------|----------------|---------|
| 100명 | ~$195 | $1.95 | $999 | $804 |
| 1,000명 | ~$1,450 | $1.45 | $9,990 | $8,540 |
| 10,000명 | ~$14,500 | $1.45 | $99,900 | $85,400 |
| 50,000명 | ~$72,500 | $1.45 | $499,500 | $427,000 |

---

## 8. 구현 로드맵

### Phase 1: MVP (2~3주)

- [ ] 한국 남친 페르소나 설계 및 reference image 생성
- [ ] 유저 DB 스키마 설계 및 구축
- [ ] Claude API 기반 대화 엔진 개발
- [ ] WhatsApp Webhook 수신 처리
- [ ] 셀카 요청 감지 및 fal.ai 이미지 생성 연동

### Phase 2: 선톡 시스템 (1~2주)

- [ ] WhatsApp Template Message 등록 및 Meta 승인
- [ ] Cron 기반 스케줄러 개발
- [ ] 상황별 프롬프트 라이브러리 구축
- [ ] 발송 이력 추적 및 품질 모니터링

### Phase 3: 미디어 확장 (1~2주)

- [ ] fal.ai 동영상 생성 연동
- [ ] 미디어 캐시 시스템 구축
- [ ] 음성 메시지 생성 (TTS) 검토

### Phase 4: 상용화 (2~3주)

- [ ] Stripe 결제 연동 (구독 관리)
- [ ] 유저 온보딩 플로우 (남친 타입 선택 등)
- [ ] 관리자 대시보드
- [ ] 성능 최적화 및 모니터링

---

## 9. 리스크 및 대응

| 리스크 | 심각도 | 대응 방안 |
|--------|--------|----------|
| Meta 정책 위반으로 번호 정지 | 높음 | 콘텐츠 필터링, 수위 제한, opt-in 철저 관리 |
| fal.ai 얼굴 일관성 품질 저하 | 중간 | 다수 모델 테스트, 품질 검증 파이프라인 구축 |
| 유저 과몰입/의존성 | 중간 | 이용 시간 안내, 건강한 이용 가이드 제공 |
| API 비용 급등 | 중간 | 응답 캐싱, 이미지 재활용, 비용 모니터링 알림 |
| 경쟁 서비스 출현 | 낮음 | 캐릭터 차별화, 대화 품질 우위 유지 |

---

## 10. 결론

### 기술적 타당성: **가능**

- 현재 Clawra 코드베이스에 WhatsApp 메시징과 fal.ai 이미지 생성 인프라가 이미 구현되어 있음
- 추가 개발 범위는 DB, 대화 엔진, 스케줄러, 결제 시스템
- 기존 코드 구조를 확장하여 MVP 2~3주 내 개발 가능

### 사업적 타당성: **유망**

- 유저당 원가 ~$1.5 대비 구독료 $9.99~14.99로 높은 마진율
- WhatsApp 기반으로 별도 앱 설치 불필요, 진입장벽 낮음
- 중남미 시장 타겟 시 K-콘텐츠 수요와 결합 가능

### 다음 단계

1. 한국 남친 캐릭터 컨셉 확정 및 reference image 제작
2. MVP 개발 착수 (Phase 1)
3. 소규모 베타 테스트 (10~50명)

---

*문서 끝*
